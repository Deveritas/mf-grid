!function(){function a(){var a=document.createElement("p");a.style.width="100%",a.style.height="200px";var b=document.createElement("div");b.style.position="absolute",b.style.top="0px",b.style.left="0px",b.style.visibility="hidden",b.style.width="200px",b.style.height="150px",b.style.overflow="hidden",b.appendChild(a),document.body.appendChild(b);var c=a.offsetWidth;b.style.overflow="scroll";var d=a.offsetWidth;return c===d&&(d=b.clientWidth),document.body.removeChild(b),c-d}var b='<div class="grid-container" ng-show="grid._data && grid._data.length"><div class="grid-header"><table class="grid-header-content-wrapper table"><thead class="grid-header-content"></thead></table></div><div class="grid-body"><div class="grid-body-viewport-content"><table class="grid-body-content-wrapper table"><tbody class="grid-body-content"></tbody></table></div></div></div>',c='<tr class="grid-row"><th ng-if="grid.showSelectionCheckbox" class="grid-column grid-checkbox-column"><input ng-if="grid.multiSelect" ng-checked="grid.allItemsSelected" title="Select All" type="checkbox" class="check-all" /></th><th ng-repeat="column in grid.enabledColumns" ng-style="{ width: column.width }" ng-class="{ \'grid-column-sortable\': grid.enableSorting }" ng-click="headerColumnClick(column, $index)" class="grid-column">{{ column.displayName }}<div ng-show="grid.enableSorting && grid.sortColumn === column"'+" class=\"grid-sort-icon glyphicon glyphicon-chevron-{{ grid.sortAsc ? 'down' : 'up' }} icon-chevron-{{ grid.sortAsc ? 'down' : 'up' }}\"></div></th></tr>",d='<tr mf-grid-row ng-repeat="row in grid.visibleItems" ng-class="{\'grid-row-selected\': grid.isItemSelected(row.item)}" class="grid-row"><td ng-if="grid.showSelectionCheckbox" class="grid-column grid-checkbox-column"><input ng-checked="grid.isItemSelected(row.item)" type="checkbox" /></td><td mf-grid-column ng-repeat="column in grid.enabledColumns" class="grid-column">{{ grid.getColumnValue(row.item, column, $parent) }}</td></tr>';Array.prototype.remove=Array.prototype.remove||function(a,b){var c=this.slice((b||a)+1||this.length);return this.length=0>a?this.length+a:a,this.push.apply(this,c)};var e=function(a,b){this.$parse=a,this.$interpolate=b,this._data=[],this.enabledColumns=[],this.selectedItems=[],this.visibleItems=[],this.columnDefs=[]},f={};f.guessSortFn=function(a){var b=typeof a;switch(b){case"number":return f.sortNumber;case"boolean":return f.sortBool;case"string":return a.match(/^[-+]?[£$¤]?[\d,.]+%?$/)?f.sortNumberStr:f.sortAlpha;default:return"[object Date]"===Object.prototype.toString.call(a)?f.sortDate:f.basicSort}},f.basicSort=function(a,b){return a===b?0:b>a?-1:1},f.sortNumber=function(a,b){return a-b},f.sortNumberStr=function(a,b){var c,d,e=!1,f=!1;return c=parseFloat(a.replace(/[^0-9.-]/g,"")),isNaN(c)&&(e=!0),d=parseFloat(b.replace(/[^0-9.-]/g,"")),isNaN(d)&&(f=!0),e&&f?0:e?1:f?-1:c-d},f.sortAlpha=function(a,b){var c=a.toLowerCase(),d=b.toLowerCase();return c===d?0:d>c?-1:1},f.sortDate=function(a,b){var c=a.getTime(),d=b.getTime();return c===d?0:d>c?-1:1},f.sortBool=function(a,b){return a&&b?0:a||b?a?1:-1:0},e.prototype={_data:null,columnDefs:null,showSelectionCheckbox:!0,enabledColumns:null,selectedItems:null,multiSelect:!0,allItemsSelected:!1,$parse:null,visibleItems:null,virtualizationThreshold:50,virtualizationOverflow:3,itemsBefore:0,pixelsBefore:0,height:0,viewportHeight:0,headerRowHeight:0,enableSorting:!0,rowHeight:30,scrollTop:0,sortColumn:null,_prevSortColumn:null,_prevSortAsc:!1,sortAsc:!0,_oldLength:0,headerColumnClick:null,rowClick:null,isItemKey:function(a,b){return(b.isItemKey||a.hasOwnProperty(b.field)||"undefined"!=typeof a[b.field])&&(b.isItemKey=!0),b.isItemKey||!1},isScopeKey:function(a,b){return(b.isScopeKey||a.hasOwnProperty(b.field)||"undefined"!=typeof a[b.field])&&(b.isScopeKey=!0),b.isScopeKey||!1},getColumnValueRaw:function(a,b,c){return this.isItemKey(a,b)?a[b.field]:this.isScopeKey(c,b)?c[b.field]:b.valueRaw(c||{},a)},getColumnValue:function(a,b,c){return(this.isItemKey(a,b)||this.isScopeKey(c,b))&&"function"!=typeof b.valueFiltered?this.getColumnValueRaw(a,b,c):b.valueFiltered(a)},sortByColumn:function(a,b){var c=this;if(this._prevSortColumn===a){if(this._prevSortAsc===b)return;return this._prevSortAsc=b,this._data.reverse(),void 0}this._prevSortAsc=b,this._prevSortColumn=this.sortColumn=a;var d=a.sortFn;this._data.sort(function(b,e){b=c.getColumnValueRaw(b,a),e=c.getColumnValueRaw(e,a);var g="undefined"!=typeof b&&null!==b,h="undefined"!=typeof e&&null!==e;return g||h?g&&!h?-1:!g&&h?1:("undefined"==typeof d&&(d=f.guessSortFn(b)),d(b,e)):0})},isColumnSortable:function(a){return this.enableSorting&&a.sortable},setViewportHeight:function(a){this.viewportHeight=a,this.updateVisibleItems()},setScrollTop:function(a){this.scrollTop=a,this.updateVisibleItems()},setVisibleItems:function(a){for(var b=0,c=a.length;c>b;++b)"undefined"==typeof this.visibleItems[b]&&(this.visibleItems[b]={}),this.visibleItems[b].item=a[b];this.visibleItems.length=a.length},updateVisibleItems:function(){var a=this.rowHeight+.5,b=this.viewportHeight,c=this._data.length,d=Math.ceil(b/a);if(this.totalHeight=c*a,this.itemsBefore=this.pixelsBefore=0,d>=c||c<=this.virtualizationThreshold)return this.setVisibleItems(this._data),void 0;var e=this.virtualizationOverflow,f=Math.max(this.scrollTop,0),g=~~(f/a),h=Math.min(e,g);this.itemsBefore=g-h,this.pixelsBefore=this.itemsBefore*a;var i=Math.min(this.itemsBefore+d+(e+h),c);this.setVisibleItems(this._data.slice(this.itemsBefore,i))},isItemSelected:function(a){return-1!==this.selectedItems.indexOf(a)},updateCheckAll:function(){if(this.multiSelect===!1&&this.selectedItems.length>1){var a=this.selectedItems[this.selectedItems.length-1];this.selectedItems.length=1,this.selectedItems[0]=a}this.allItemsSelected=this._data.length===this.selectedItems.length},selectItem:function(a,b){if(this.multiSelect===!1)return this.selectedItems.length=0,this.selectedItems.push(a),this.updateCheckAll(),void 0;var c=this.selectedItems.indexOf(a),d=-1!==c;b&&d||!b&&!d||(b?this.selectedItems.push(a):this.selectedItems.remove(c),this.updateCheckAll())},selectAll:function(a){if(!a)return this.allItemsSelected=!1,this.selectedItems.length=0,void 0;for(var b=0,c=this._data.length;c>b;++b)this.selectedItems.push(this._data[b]);this.allItemsSelected=!0},buildColumn:function(a){return"string"==typeof a&&(a={displayName:a,field:a,orderBy:a,valueFiltered:a,valueRaw:a,isItemKey:!0}),a.isItemKey!==!0&&(a.isItemKey=!1,"undefined"!=typeof a.cellFilter&&a.cellFilter.length>0&&"undefined"==typeof a.valueFiltered&&(a.valueFiltered=this.$interpolate("{{ "+a.field+" | "+a.cellFilter+" }}")),a.isItemKey||"undefined"!=typeof a.valueRaw||(a.valueRaw=this.$parse(a.field))),"undefined"==typeof a.sortable&&(a.sortable=!0),a},setData:function(a){var b=this._data!==a||this._oldLength!==a.length;(null===a||"undefined"==typeof a)&&(a=[]),this._data=a,this._oldLength=a.length;for(var c=[],d=0,e=this.selectedItems.length;e>d;++d){var f=this.selectedItems[d];-1!==a.indexOf(f)&&c.push(f)}this.selectedItems=c,this.updateCheckAll(),this.enabledColumns=[];var g=this.columnDefs;if(g)for(var h=0,e=g.length;e>h;++h){var i=this.buildColumn(g[h]);this.ignoreColumns&&this.ignoreColumns.hasOwnProperty(i.field)||this.enabledColumns.push(i)}else for(var j in a[0])this.enabledColumns.push(this.buildColumn(j));b&&this.sortColumn&&this.sortByColumn(this.sortColumn,this.sortAsc),this.updateVisibleItems()}},angular.module("mf-grid",[]).controller("MfGridCtrl",["$parse","$interpolate",function(a,b){return new e(a,b)}]).directive("mfGrid",["$http","$templateCache","$compile","$timeout","$window",function(e,f,g,h,i){function j(b,j,k,l){function m(){b.scrollbarWidth=t.scrollHeight>t.offsetHeight?a():0,l.setViewportHeight(t.offsetHeight)}function n(){m(),b.$digest()}function o(){q[0].scrollLeft=t.scrollLeft;var a=t.scrollTop,c=1,d=y-l.rowHeight*c,e=y+l.rowHeight*c;a>=d&&e>=a||(y=a,l.setScrollTop(a),v[0].style.top=l.pixelsBefore+"px",b.$digest())}function p(a){var b=a.closest(".grid-row").scope();if(b)return b.row.item}var q=j.find(".grid-header"),r=q.find(".grid-header-content"),s=j.find(".grid-body"),t=s[0],u=j.find(".grid-body-viewport-content"),v=s.find(".grid-body-content-wrapper"),w=s.find(".grid-body-content");if(!t)throw new Error(".grid-body not found.");l.rowHeight=parseInt(l.rowHeight,10)||50,b.$watchCollection("$parent."+l.data,function(a){l.setData(a),m()}),b.$watchCollection("grid.columnDefs",function(){l.setData(l._data)}),b.$watchCollection("grid.selectedItems",function(){l.updateCheckAll(),l.selectionChanged&&l.selectionChanged(l.selectedItems)}),b.$watch("grid.multiSelect",function(){l.updateCheckAll()});var x=angular.element(i);x.on("resize",n),b.$on("$destroy",function(){l._data=null,l.columnDefs=null,l.selectedItems=null,l.visibleItems=null,x.off("resize",n)}),b.$watch("grid.height",function(a){a&&j.height(a),h(function(){m()})}),b.$watch("grid.scrollbarWidth",function(a){"undefined"!=typeof a&&null!==a&&q.css("margin-right",a+"px")}),b.$watch("grid.totalHeight",function(a){"undefined"!=typeof a&&null!==a&&u.css("height",a+"px")}),b.$watch("grid.headerRowHeight",function(a){a=parseInt(a,10)||0;var b=q.find(".grid-row");0!==b.length&&(b[0].style.height=a+"px",t.style.top=b.height()+"px"),m()}),b.headerColumnClick=function(a,b){l.enableSorting&&(l.sortColumn=a,l.sortAsc=l.sortColumn===a?!l.sortAsc:!0,"function"==typeof l.headerColumnClick?l.headerColumnClick("string"==typeof a.value?a.value:a,b,l.sortAsc):l.sortByColumn(a,l.sortAsc))};var y=0;t.addEventListener("scroll",o),q.on("click","input.check-all",function(){l.selectAll(this.checked),b.$apply()}),w.on("click",".grid-column",function(a){if(!angular.element(a.target).is("input:checkbox")){var c=angular.element(this),d=p(c);d&&(c.is(".grid-checkbox-column")?(a.stopImmediatePropagation(),l.selectItem(d,!l.isItemSelected(d))):l.rowClick&&l.rowClick(d,l._data.indexOf(d)),b.$apply())}}),w.on("click","input:checkbox",function(a){a.stopImmediatePropagation(),l.selectItem(p(angular.element(this)),this.checked),b.$apply()}),l.rowTemplateUrl||l.rowTemplate||(l.rowTemplate=d),l.rowTemplate?w.append(g(l.rowTemplate)(b)):e.get(l.rowTemplateUrl,{cache:f}).success(function(a){w.append(g(a)(b))}),l.headerRowTemplateUrl||l.headerRowTemplate||(l.headerRowTemplate=c),l.headerRowTemplate?r.append(g(l.headerRowTemplate)(b)):e.get(l.headerRowTemplateUrl,{cache:f}).success(function(a){r.append(g(a)(b))})}return{restrict:"A",scope:{grid:"=mfGrid"},replace:!0,controller:"MfGridCtrl",template:b,link:function(a,b,c,d){var e=a.grid||{};for(var f in e)e.hasOwnProperty(f)&&(d[f]=e[f]);a.grid=d,j(a,b,c,d)}}}]).directive("mfGridRow",[function(){return{restrict:"A",require:"^mfGrid",link:function(a,b,c,d){b[0].style.height=d.rowHeight+"px",a.$watch("grid.itemsBefore",function(){a.itemIndex=d.itemsBefore+a.$index})}}}]).directive("mfGridColumn",[function(){return{restrict:"A",link:function(a,b){b[0].style.width=a.column.width}}}])}();