!function(){Array.prototype.remove=Array.prototype.remove||function(a,b){var c=this.slice((b||a)+1||this.length);return this.length=0>a?this.length+a:a,this.push.apply(this,c)};var a=function(a,b){this.options={},this.$parse=a,this.$interpolate=b,this.data=[],this.enabledColumns=[],this.selectedItems=[],this.visibleData=[]},b={};b.guessSortFn=function(a){var c=typeof a;switch(c){case"number":return b.sortNumber;case"boolean":return b.sortBool;case"string":return a.match(/^[-+]?[£$¤]?[\d,.]+%?$/)?b.sortNumberStr:b.sortAlpha;default:return"[object Date]"===Object.prototype.toString.call(a)?b.sortDate:b.basicSort}},b.basicSort=function(a,b){return a===b?0:b>a?-1:1},b.sortNumber=function(a,b){return a-b},b.sortNumberStr=function(a,b){var c,d,e=!1,f=!1;return c=parseFloat(a.replace(/[^0-9.-]/g,"")),isNaN(c)&&(e=!0),d=parseFloat(b.replace(/[^0-9.-]/g,"")),isNaN(d)&&(f=!0),e&&f?0:e?1:f?-1:c-d},b.sortAlpha=function(a,b){var c=a.toLowerCase(),d=b.toLowerCase();return c===d?0:d>c?-1:1},b.sortDate=function(a,b){var c=a.getTime(),d=b.getTime();return c===d?0:d>c?-1:1},b.sortBool=function(a,b){return a&&b?0:a||b?a?1:-1:0},a.prototype={options:null,data:null,enabledColumns:null,selectedItems:null,allItemsSelected:!1,$parse:null,visibleData:null,rowsBefore:0,pixelsBefore:0,rowsAfter:0,height:0,headerRowHeight:0,scrollTop:0,sortColumn:null,oldLength:0,getColumnValueRaw:function(a,b,c){return"string"==typeof b.valueRaw?a[b.valueRaw]:b.valueRaw(c||{},a)},getColumnValue:function(a,b,c){return"undefined"==typeof b.valueFiltered?this.getColumnValueRaw(a,b,c):"string"==typeof b.valueFiltered?a[b.valueFiltered]:b.valueFiltered(a)},sortByColumn:function(a){var c=this;if(this.sortColumn===a)return this.data.reverse(),void 0;this.sortColumn=a;var d=a.sortFn;this.data.sort(function(e,f){e=c.getColumnValueRaw(e,a),f=c.getColumnValueRaw(f,a);var g="undefined"!=typeof e&&null!==e,h="undefined"!=typeof f&&null!==f;return g||h?g&&!h?-1:!g&&h?1:("undefined"==typeof d&&(d=b.guessSortFn(e)),d(e,f)):0})},isColumnSortable:function(a){return this.options.enableSorting&&a.sortable},getCheckboxColumnWidth:function(){return"30px"},getColumnStyle:function(a){return{width:a.width}},isItemSelected:function(a){return-1!==this.selectedItems.indexOf(a)},updateCheckAll:function(){this.allItemsSelected=this.data.length===this.selectedItems.length},setHeight:function(a){this.height=a,this.updateVisibleItems()},setHeaderRowHeight:function(a){this.headerRowHeight=a,this.updateVisibleItems()},setScrollTop:function(a){this.scrollTop=a,this.updateVisibleItems()},setVisibleItems:function(a){for(var b=0,c=a.length;c>b;++b)"undefined"==typeof this.visibleData[b]&&(this.visibleData[b]={}),this.visibleData[b].item=a[b];this.visibleData.length=a.length},updateVisibleItems:function(){var a=this.options.rowHeight,b=this.height,c=this.data.length,d=Math.ceil(b/a);if(this.totalHeight=c*a,d>=c)return this.pixelsAfter=this.rowsBefore=this.pixelsBefore=this.rowsAfter=0,this.setVisibleItems(this.data),void 0;var e=5,f=Math.max(this.scrollTop,0),g=Math.floor(f/a),h=Math.min(e,g);this.rowsBefore=g-h,this.pixelsBefore=this.rowsBefore*a;var i=Math.min(this.rowsBefore+d+(e+h),c);this.rowsAfter=c-i,this.pixelsAfter=this.rowsAfter*a,this.setVisibleItems(this.data.slice(this.rowsBefore,i))},selectItem:function(a,b){var c=this.selectedItems.indexOf(a),d=-1!==c;b&&d||!b&&!d||(b?this.selectedItems.push(a):this.selectedItems.remove(c),this.updateCheckAll())},selectAll:function(a){if(!a)return this.allItemsSelected=!1,this.selectedItems.length=0,void 0;for(var b=0,c=this.data.length;c>b;++b)this.selectedItems.push(this.data[b]);this.allItemsSelected=!0},buildColumn:function(a){return"string"==typeof a?a={displayName:a,field:a,orderBy:a,valueFiltered:a,valueRaw:a}:("undefined"!=typeof a.cellFilter&&a.cellFilter.length>0&&"undefined"==typeof a.valueFiltered&&(a.valueFiltered=this.$interpolate("{{ "+a.field+" | "+a.cellFilter+" }}")),"undefined"==typeof a.valueRaw&&(a.valueRaw=this.$parse(a.field))),"undefined"==typeof a.sortable&&(a.sortable=!0),a},setData:function(a){var b=this.data!==a||this.oldLength!==a.length;this.data=a||[],this.oldLength=a.length,this.selectedItems=[],this.allItemsSelected=!1,this.enabledColumns=[];var c=this.options.columns||this.options.columnDefs;if(c)for(var d=0,e=c.length;e>d;++d){var f=this.buildColumn(c[d]);this.options.ignoreColumns&&this.options.ignoreColumns.hasOwnProperty(f.field)||this.enabledColumns.push(f)}else if(a&&a.length>0)for(var g in a[0])this.enabledColumns.push(this.buildColumn(g));b&&this.sortColumn&&this.sortByColumn(this.sortColumn),this.updateVisibleItems()}},angular.module("mf-grid",[]).controller("MfGridCtrl",["$parse","$interpolate",function(b,c){return new a(b,c)}])}(),function(){var a='<td ng-if="grid.options.showSelectionCheckbox" ng-style="{ width: grid.getCheckboxColumnWidth() }" class="column"><input name="{{ grid.options.selectionCheckboxInputName }}" value="{{ row[grid.options.selectionCheckboxInputValue] }}" ng-checked="grid.isItemSelected(row.item)" type="checkbox" /></td><td ng-repeat="column in grid.enabledColumns" ng-style="grid.getColumnStyle(column)" ng-bind="grid.getColumnValue(row.item, column, $parent)" class="column"></td>';angular.module("mf-grid").directive("mfGrid",["$parse","$http","$templateCache","$compile",function(b){function c(b,c,d,e){function f(){e.setScrollTop(k.scrollTop),b.$apply()}function g(a){return a.closest(".row").scope().row.item}var h=c.find(".grid-viewport"),i=c.find(".grid-header"),j=c.find(".grid-body"),k=c.find(".grid-viewport").get(0);e.options.rowHeight=parseInt(e.options.rowHeight,10)||50,e.options.rowTemplateUrl||e.options.rowTemplate||(e.options.rowTemplate=a),b.$watchCollection(e.options.data,function(a){e.setData(a)}),b.$watchCollection(function(){return e.options.columns||e.options.columnDefs},function(){e.setData(e.data)}),b.$watchCollection("grid.selectedItems",function(){e.updateCheckAll(),e.options.selectionChanged&&e.options.selectionChanged(e.selectedItems)}),b.$watch("grid.options.height",function(a){e.options.height||(e.options.height=a=300),c.height(a),h.css({top:e.options.headerRowHeight,height:a-e.options.headerRowHeight}),e.setHeight(h.height())}),b.$watch("grid.options.headerRowHeight",function(a){e.options.headerRowHeight&&i.find(".row").height(a),e.setHeaderRowHeight(i.find(".row").height())}),b.columnClick=function(a,b){e.options.columnClick?e.options.columnClick("string"==typeof a.value?a.value:a,b):e.sortByColumn(a)},c.find(".grid-viewport").on("scroll",f),i.on("click","input.check-all",function(){e.selectAll(this.checked),b.$apply()}),j.on("click",".row",function(){if(e.options.rowClick){var a=angular.element(this).scope();e.options.rowClick(a.row,a.$index),a.$apply()}}),j.on("click",".column",function(a){if(!$(a.target).is(":not(.column)")){var c=$(this),d=c.find("input:checkbox");d.length>0&&(a.stopImmediatePropagation(),e.selectItem(g(d),!d[0].checked)),b.$apply()}}),j.on("click","input:checkbox",function(a){a.stopImmediatePropagation(),e.selectItem(g(angular.element(this)),this.checked),b.$apply()})}return{restrict:"A",scope:!0,replace:!0,controller:"MfGridCtrl",controllerAs:"grid",templateUrl:"views/mf-grid.html",link:function(a,d,e,f){var g=e.mfGrid||e.mfGridTable,h=b(g);f.options=h(a)||{},c(a,d,e,f)}}}]).directive("mfGridRow",["$compile","$http","$templateCache",function(a,b,c){return{restrict:"A",scope:!0,replace:!0,require:"^mfGrid",compile:function(){return{post:function(d,e,f,g){e.height(g.options.rowHeight),d.$watch("grid.rowsBefore",function(a){d.gridIndex=a+d.$index}),g.options.rowTemplate?e.append(a(g.options.rowTemplate)(d)):b.get(g.options.rowTemplateUrl,{cache:c}).success(function(b){e.append(a(b)(d))})}}}}}])}();